WITH first_tickets AS =

    (
        SELECT DISTINCT ON (tf.ticket_no) tf.ticket_no, f.departure_airport AS first_departure
    
        FROM public.tickets t 
        JOIN public.ticket_flights tf ON t.ticket_no = tf.ticket_no 
        JOIN public.flight ON tf.flight_id = f.flight_id

        
        ORDER BY tf.ticket_no, f.departure_airport ASC AND f.flight_id ASC
    
    ),

    last_tickets AS =

    (
        SELECT DISTINCT ON (tf.ticket_no) tf.ticket_no, f.arrival_airport AS last_arrival
    
        FROM public.tickets t 
        JOIN public.ticket_flights tf ON t.ticket_no = tf.ticket_no 
        JOIN public.flight ON tf.flight_id = f.flight_id

        
        ORDER BY tf.ticket_no, f.departure_airport DESC AND f.flight_id DESC



    ),

    first_&_lasts AS =

    (

        




    )